---
title: "Task 3 - Santa Barbara urchins (McManus)"
author: "Nick McManus"
date: "10/22/2021"
output: html_document
---

## Overview

INFO HERE

**Data citation:** Reed, D. 2020. SBC LTER: Reef: Long-term experiment: Kelp removal: Urchin size frequency distribution ver 20. Environmental Data Initiative. <https://doi.org/10.6073/pasta/5a1e9ef03aa47bd2225c0bb98a02a63b>.

## Setup

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE, messages = FALSE, warning = FALSE)
# attach packages
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(kableExtra)
library(viridis)
```

First I will read in the data from `urchins.csv`

```{r}
#read in data
urchins <- read_csv(here("data","urchins.csv"))
```

Next I will clean up the column headings to make the data easier to work with.

```{r}
#convert column names to lowersnake case
urchins_clean <- clean_names(urchins) %>% 
  #add units to size column for clarity
  rename(size_cm = size) %>% 
  #change date to standardized format
  mutate(date = mdy(date))
  
```

## Section 1 - Urchin Size Distribution by Species

In this section I will compare the distribution of sizes between purple and red urchins.

```{r, fig.cap = "**Fig. 1: Distribution of purple and red sea urchin sizes found at SBC LTER research sites.** Purple urchin (*Strongylocentrotus purpuratus*) and red urchin (*Mesocentrotus franciscanus*) More descriptive info about caption here"}

# assign data to the plot
ggplot(data = urchins_clean) +
  # create histogram and set aesthetics
  geom_histogram(
    aes(x = size_cm, fill = common_name),
    color = "black",
    bins = 12,
    show.legend = FALSE) +  #remove redundant legend
  
  #change labels
  labs(x = "Urchin size (cm)",
       y = "Frequency") +
  
  scale_fill_manual(values = c("purple", "red")) +
  
    #make histogram faceted to urchin type 
  facet_wrap(~ common_name) +
  
  #set theme
  theme(
    axis.title.x = element_text(size = 13),
    axis.title.y = element_text(size = 13)) +
  
  theme_bw()

```

```{r}
# calculate summary table with stats of interest
stats_urchins <- urchins_clean %>% 
  group_by(common_name) %>% 
  summarize(mean_size_cm = round(mean(size_cm), digits = 1),  #use round() to change the number of decimals
            median_size_cm = round(median(size_cm), digits = 1),
            sd_size = round(sd(size_cm), digits = 1),
            sample_size = n())

# create table to display stats
stats_urchins %>% 
  kable(col.names = c("Species",
                      "Mean (cm)",
                      "Median (cm)",
                      "Standard deviation (cm)",
                      "Sample size (n)"),
        caption = "**Table 1.** Descriptive statistics of purple and red urchin sizes.") %>% 
  
  kable_classic(full_width = TRUE,
                bootstrap_options = "hover",
                position = "left")
```


The central tendency(metrics)(mean and median) for both the red and purple urchins are consistent. The distribution for purple urchin sizes skews positively and has a smaller spread (std dev). Red urchin sizes are spread more and slightly more normally distributed.



## Section 2 - Purple urchin counts by location and year.

```{r}
#create subset of data for purple urchins
purple_urchins <- urchins_clean %>% 
  filter(common_name == "Purple Urchin") %>% 
  mutate(date = ymd(date),
         year = year(date),        #new column with year
         site_full = case_when(    #change site abbreviations to full names
           site == "NAPL" ~ "Naples Reef",
           site == "AQUE" ~ "Arroyo Quemado Reef",
           site == "CARP" ~ "Carpinteria Reef",
           site == "MOHK" ~ "Mohawk Reef",
           site == "IVEE" ~ "Isla Vista Reef"))
```


```{r}
# find total number of purple urchins observed by site and year
purple_urchins_site_year <- purple_urchins %>% 
  group_by(site, year) %>% 
  summarize(sample_size = n())

head(purple_urchins_site_year)
```



```{r, fig.cap = **Figure 2. Change in Purple Urchin count over time**. More specific captions stuff here.}
ggplot(data = purple_urchins_site_year, aes(x = year, y = sample_size)) +
  
  geom_line(aes(color = site),
            size = 1.3,      #change line width
            alpha = 0.9) +   #change line transparency
  
  #change line colors
  scale_color_manual(values = c("magenta", "darkblue", "aquamarine4", "firebrick3", "goldenrod")) +
  
  scale_x_continuous(breaks = 2008:2020) +
  
  #change labels
  labs(y = "Sample size (n)",
       x = "Year")+
  
  theme_minimal() +   #how to change the grid lines?
  
  theme(
    legend.position = "top",
    legend.title = element_blank()
  )
```
Assume that the methodology (surveyed area size) remains constant every where. 
